<?php get_header(); ?>
<!-- start content -->
		<div class='wrap'>

			<!-- start landing marquee -->
			<div class='landing-marquee_video dharmatalks'>
				<header class='rubric_top'>
						<h1><span class='icon icon-dept_dharmatalks'></span>Dharma Talks</h1>
						<p>Video teachings and discussions with contemporary Buddhist teachers</p>
                                                <a class='button' href='<?php echo bloginfo('url')."/dharmatalks-archive"; ?>'>Dharma Talks Archive</a>
				</header>

				<main>
					<?php
                                        
                                            $args = array(
                                            'posts_per_page' => 1,
                                            'orderby' => 'post_date',
                                            'order' => 'DESC',
                                            'post_type' => DHARMATALKS_POST_TYPE,
                                            'post_status' => 'publish',
                                            'suppress_filters' => true
                                            );
                                            
                                            $queryfirst = new WP_Query($args);
                                            query_posts( $queryfirst );
                                            while ( $queryfirst->have_posts() ) : $queryfirst->the_post();
                                            $postId[] = $queryfirst->post->ID;
                                            
                                            $topicSet = get_the_terms( get_the_ID(), "topic" );
                                            $topicName = isset($topicSet[0]) ? $topicSet[0]->name : "" ;
                                            $topicSlug = isset($topicSet[0]) ? $topicSet[0]->slug : "" ; 
                                            
                                        ?>
					<article class='dharmatalks'>
						<section class='titles'>
							<time><?php the_date('M Y'); ?></time>
							<h2 class='dharmatalks'><span class='topic'><a href='<?php getTopicUrl($topicSlug); ?>'><?php echo $topicName; ?></a></span></h2>
							<h1><a href='<?php the_permalink(); ?>'><?php the_title(); ?></a></h1>
							<address><?php echo getAuthorDetail(get_the_ID(),0,0); ?></address>
						</section>
						<figure>
							<a href='<?php the_permalink(); ?>'>
								<div class='icon-video_play' data-grunticon-embed></div>
								<?php /* ?><img src='<?php echo get_template_directory_uri(); ?>/images/jpg/home-llama_1x.jpg'
									srcset='<?php echo get_template_directory_uri(); ?>/images/jpg/home-llama_4x.jpg 2000w,
													<?php echo get_template_directory_uri(); ?>/images/jpg/home-llama_2x.jpg 1000w,
													<?php echo get_template_directory_uri(); ?>/images/jpg/home-llama_1x.jpg 500w'
									sizes= '(min-width: 60em) 75vw,
													100vw'
									alt='Llama' /> <?php */ ?>
								<?php echo srcset_post_thumbnail(get_the_ID(), 'image', '','(min-width: 60em) 75vw, 100vw'); ?>	
							</a>
						</figure>
						<section class='synopsis'>
							<p><?php the_excerpt(); ?></p>
							<p class='h2'><a class='view-contents' href='<?php the_permalink(); ?>'>Watch Talk</a></p>
						</section>
					</article>
					<?php
                                            endwhile;
                                            wp_reset_query();
                                        ?>
				</main>
			</div>
			<!-- end landing marquee -->

			<!-- start landing stack -->
			<div class='landing-stack_video'>
				
				<?php
					$allrecords = array();
					$allrecordsSet = array();
					$record_show = array(0=>2,1=>4);
					
					$args = array(
					'posts_per_page' => 6,
					'orderby' => 'post_date',
					'order' => 'DESC',
					'post_type' => DHARMATALKS_POST_TYPE,
					'post_status' => 'publish',
					'post__not_in' => $postId,
					'suppress_filters' => true
					);
					
					$query = new WP_Query($args);
					query_posts( $query );
					while ( $query->have_posts() ) : $query->the_post();
					
						$allrecords['postId'] = get_the_ID();
						$allrecords['title'] = get_the_title();
						$allrecords['excerpt'] = get_the_excerpt();
						$allrecords['permalink'] = get_the_permalink();
						$allrecords['author'] = get_post_meta(get_the_ID() ,'authors_name_metabox',true);
						$allrecords['publish_date'] = get_the_date('M Y');
						$allrecords['featured_image'] = srcset_post_thumbnail( $query->post->ID,  'image', '','(min-width: 50em) 25vw,100vw');
						$allrecordsSet[] = $allrecords;
					endwhile;
					wp_reset_query();				      
				?>
				
				<?php                                
					$display_index = 0;
					foreach($record_show as $key=>$val)
					{
					    for($i=0;$i<$val;$i++)
					    {
						
						if(isset($allrecordsSet[$display_index]))
						{
						    $topicSet = get_the_terms( $allrecordsSet[$display_index]['postId'], "topic" );
						    $topicName = isset($topicSet[0]) ? $topicSet[0]->name : "" ;
						    $topicSlug = isset($topicSet[0]) ? $topicSet[0]->slug : "" ;                                                                                       
				?>		
						<article class='dharmatalks'>
							<section class='titles'>
								<time><?php echo $allrecordsSet[$display_index]['publish_date']; ?></time>
								<h2 class='dharmatalks'><span class='topic'><a href='<?php getTopicUrl($topicSlug); ?>'><?php echo $topicName; ?></a></span></h2>
								<h1><a href='<?php echo $allrecordsSet[$display_index]['permalink']; ?>'><?php echo $allrecordsSet[$display_index]['title']; ?></a></h1>
								<address><?php echo getAuthorDetail($allrecordsSet[$display_index]['postId'],0,0); ?></address>
							</section>
							<figure>
								<a href='<?php echo $allrecordsSet[$display_index]['permalink']; ?>'>
									<div class='icon-video_play' data-grunticon-embed></div>
									<?php echo $allrecordsSet[$display_index]['featured_image']; ?>
								</a>
							</figure>
							<section class='synopsis'>
								<p><?php echo $allrecordsSet[$display_index]['excerpt']; ?></p>
								<p class='h2'><a class='view-contents' href='<?php echo $allrecordsSet[$display_index]['permalink']; ?>'>Watch Talk</a></p>
							</section>
						</article>
				
				
					<?php
						$display_index++;
						}
					}
					if($val==2){ ?>					
						<div class='CTA-module'>
							<div class='rule'></div>
							<div class='CTA-ad' style='
								background-color: #ddd;
								line-height: 1; padding: 2em;
								margin: 0 auto;
								width: 75%;
								height: 10em;
								text-align: center;
							'>
							<p>Call-to-Action Module. Can be set in the CMS to any of the following: (1) Ad served via Google DFP Small Business (TBD), (2) Daily Dharma, (3) Subscribe CTA, (4) Newletter CTA</p>
							</div>
							<div class='rule'></div>
						</div>						
					<?php }
					
                                        if($val==4){ ?>
						<div class='more dharmatalks'>
							<a class='button' href='<?php echo bloginfo('url')."/dharmatalks-archive"; ?>'>Dharma Talks Archive</a>
						</div>                                        
					<?php } ?>
					
				<?php
                                   
                                }
                            ?>
				
			</div>


			<div class='rule'></div>
			<!-- end landing stack -->

			<!-- start most popular module -->
			<?php
					
			$mostpopularpost  = getMostViewPosts(DHARMATALKS_POST_TYPE,$postId,3);
			if(!empty($mostpopularpost))
			{
			?>
				<div class='related-posts'>
					<header class='rubric_top'>
							<h1>Most Popular</h1>
					</header>
	
					<main>
						<?php
							foreach($mostpopularpost as $mostpopular)
							{
						?>
							<article class='dharmatalks'>
								<figure>
									<a href='<?php echo $mostpopular['permalink']; ?>'>
										<div class='icon-video_play' data-grunticon-embed></div>
										<?php echo srcset_post_thumbnail($mostpopular['postId'], 'image', '','(min-width: 50em) 33vw,100vw'); ?>
									</a>
								</figure>
								<section>
									<h2 class='rubric dharmatalks'><span class='topic'><a href='<?php echo $mostpopular['topicSlug']; ?>'><?php echo $mostpopular['topicName']; ?></a></span></h2>
									<h1><a href='<?php echo $mostpopular['permalink']; ?>'><?php echo $mostpopular['title']; ?></a></h1>
									<address><?php echo getAuthorDetail($mostpopular['postId'],0,0); ?></address>
									<time><?php echo $mostpopular['publish_date']; ?></time>
								</section>
							</article>
						<?php 	}
							
						?>
						
					</main>
				</div>
			<?php } ?>

			<!-- start Call to Action module -->
			<div class='CTA-module'>
				<div class='rule'></div>
				<div class='CTA-ad' style='
					background-color: #ddd;
					line-height: 1; padding: 2em;
					margin: 0 auto;
					width: 75%;
					height: 10em;
					text-align: center;
				'>
				<p>Call-to-Action Module. Can be set in the CMS to any of the following: (1) Ad served via Google DFP Small Business (TBD), (2) Daily Dharma, (3) Subscribe CTA, (4) Newletter CTA</p>
				</div>
				<div class='rule'></div>
			</div>
			<!-- end Call to Action module -->

			<aside>

				<div class='aside-depts'>
					<!-- start aside Film Club -->
					<section class='aside-filmclub'>
						<header class='rubric_small'>
								<h1><a href='<?php echo get_site_url() . '/' . FILM_CLUB_POST_TYPE; ?>'><span class='icon icon-dept_filmclub'></span>Film Club</a></h1>
								<p>Buddhist films and discussion for the Tricycle Community</p>
						</header>

						<main>
							<?php
                                                    
								$args = array(
								'posts_per_page' => 1,
								'orderby' => 'post_date',
								'order' => 'DESC',
								'post_type' => FILM_CLUB_POST_TYPE,
								'post_status' => 'publish',
								'suppress_filters' => true
								);
								
								$querydharma = new WP_Query($args);
								query_posts( $querydharma );
								while ( $querydharma->have_posts() ) : $querydharma->the_post();
								
								    $topicSet = get_the_terms( get_the_ID(), "topic" );
								    $topicName = isset($topicSet[0]) ? $topicSet[0]->name : "";
								    $topicSlug = isset($topicSet[0]) ? $topicSet[0]->slug : "" ;
                                                      
							?>
							<article>
								<figure>
									<a href='<?php the_permalink(); ?>'>
										<div class='icon-video_play' data-grunticon-embed></div>
										<?php echo srcset_post_thumbnail(get_the_ID(), 'image', '','(min-width: 50em) 33vw,100vw'); ?>
									</a>
								</figure>
								<section>
									<h2 class='rubric filmclub'><span class='topic'><a href='<?php getTopicUrl($topicSlug); ?>'><?php echo $topicName; ?></a></span></h2>
									<h1><a href='<?php the_permalink(); ?>'><?php the_title(); ?></a></h1>
									<p><?php the_excerpt(); ?></p>
									<address><?php echo getAuthorDetail(get_the_ID(),1,0); ?></address>
								</section>
							</article>
							<?php
								endwhile;
								wp_reset_query();
							?>
						</main>
					</section>
					<!-- end aside Film Club -->

					<!-- start aside magazine -->
					<section class='aside-magazine'>
						<header class='rubric_small'>
								<h1><a href='<?php echo get_site_url() . '/' . MAGAZINE_POST_TYPE; ?>'><span class='icon icon-dept_magazine'></span>Magazine</a></h1>
								<p>The Buddhist Review</p>
						</header>

						<main>
							<?php
                                                        
								$args = array(
								'posts_per_page' => 1,
								'orderby' => 'post_date',
								'order' => 'DESC',
								'post_type' => MAGAZINE_POST_TYPE,
								'post_status' => 'publish',
								'suppress_filters' => true
								);
								
								$querymagazine = new WP_Query($args);
								query_posts( $querymagazine );
								while ( $querymagazine->have_posts() ) : $querymagazine->the_post();
								
								    $topicSet = get_the_terms( get_the_ID(), "topic" );
								    $topicName = isset($topicSet[0]) ? $topicSet[0]->name : "";
								    $topicSlug = isset($topicSet[0]) ? $topicSet[0]->slug : "" ;
								    
								    $issueSet = get_the_terms( get_the_ID(), "magazine-issue" );
								    $issueName = isset($issueSet[0]) ? $issueSet[0]->name : "";
								    $issueSlug = isset($issueSet[0]) ? $issueSet[0]->slug : "" ;
                                                      
							?>
						    
							<article>
								<figure>
									<a href='<?php the_permalink(); ?> '>
										<?php echo srcset_post_thumbnail(get_the_ID(), 'image', '','(min-width: 50em) 33vw,100vw'); ?>
									</a>
								</figure>
								<section>
									<h2 class='rubric magazine'><span class='topic'><a href='<?php getTopicUrl($topicSlug); ?>'><?php echo $topicName; ?></span></h2>
									<h1><a href='<?php the_permalink(); ?>'><?php the_title(); ?></a></h1>
									<p><?php the_excerpt(); ?></p>
									<address><?php echo getAuthorDetail(get_the_ID(),1,0); ?></address>
									<time><?php echo $issueName; ?></time>
								</section>
							</article>
							<?php
                                                            endwhile;
                                                            wp_reset_query();
                                                        ?>
						</main>
						<div class='rule-responsive'></div>
					</section>
					<!-- end aside magazine -->

					<!-- start aside trikedaily -->
					<section class='aside-trikedaily'>
						<header class='rubric_small'>
								<h1><a href='<?php echo get_site_url() . '/blog' ; ?>'><span class='icon icon-dept_trikedaily'></span>Trike Daily</a></h1>
								<p>Daily wisdom, teachings &amp; critique</p>
						</header>

						<main>
							<?php
								$args = array(
								    'posts_per_page' => 1,
								    'orderby' => 'post_date',
								    'order' => 'DESC',
								    //'post_type' => 'post',
								    'post_status' => 'publish',
								    'suppress_filters' => true
								);
								    
								$querymagazine = new WP_Query($args);
								query_posts($querymagazine);
								while ($querymagazine->have_posts()) : $querymagazine->the_post();
								
								$topicSet = get_the_terms(get_the_ID(), "topic");
								$topicName = isset($topicSet[0]) ? $topicSet[0]->name : "";
								$topicSlug = isset($topicSet[0]) ? $topicSet[0]->slug : "";
					
							?>
							<article>
								<figure>
									<a href='<?php the_permalink(); ?>'>										
										<?php echo srcset_post_thumbnail(get_the_ID(), 'image', '','(min-width: 50em) 33vw,100vw'); ?>
									</a>
								</figure>
								<section>
									<h2 class='rubric trikedaily'><span class='topic'><a href='<?php getTopicUrl($topicSlug); ?>'><?php echo $topicName; ?></a></span></h2>
									<h1><a href='<?php the_permalink(); ?>'><?php the_title(); ?></a></h1>
									<p><?php the_excerpt() ?></p>
									<address><?php echo getAuthorDetail(get_the_ID(),1,0); ?></address>
									<time><?php the_date('M d, Y'); ?></time>
								</section>
							</article>
							<?php
								endwhile;
								wp_reset_query();
							?>
						</main>
						<div class='rule-responsive'></div>
					</section>
					<!-- end aside trikedaily -->
				</div>

				<div class='rule'></div>

				
		<!-- end wrap_outer -->
<?php get_footer(); ?>