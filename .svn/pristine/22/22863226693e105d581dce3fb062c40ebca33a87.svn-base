<?php $author = $wp_query->get_queried_object();
$authorname = $author->user_nicename;
$authorId = $author->ID;
?>
<?php get_header(); ?>
<?php
global $wp_query;
//pr($wp_query);
?>
<!-- start content -->
<div class='wrap'>
    <!-- start landing marquee -->
    <div class='landing-marquee'>
        <header class='rubric_top'>
            <h1><?php echo $authorname; ?></h1>
        </header>

        <main class='landing-marquee-articles'>

            <?php
            $counter = 1;
            while (have_posts()): the_post();
                
                $post_type = get_post_type();
                $postValues = get_post_type_object($post_type);
                $labels = $postValues->labels; //to fetch the menu name
                $postMenuName = $labels->menu_name;
                $post_link = get_post_type_archive_link($post_type);
                
                if ($post_type == "post") {
                    $post_type = "trikedaily";
                    $postMenuName = "Trike Daily";
                    $post_link = get_permalink(get_page_id_by_slug(TRIKE_DAILY_SLUG));
                }
                $topics = get_topics_by_post_id(get_the_ID());
                $topic_urls = $topics && isset($topics['names_with_urls']) ? implode(", ", $topics['names_with_urls']) : "";
                
                $postId[] = $post->ID;
                $byline = get_post_meta($post->ID, 'authors_select_metabox', true);
                $byauthor = get_post_meta($post->ID, 'authors_name_metabox', true);
                
                ?>
                <article class = '<?php echo $post_type; ?>' >
                    <figure>
                        <a href = '<?php the_permalink(); ?>'>
                            <?php if ($post_type == DHARMATALKS_POST_TYPE || $post_type == FILM_CLUB_POST_TYPE || $post_type == FILM_FESTIVAL_POST_TYPE ) { 
                                echo "<div class='icon-video_play' data-grunticon-embed></div>";
                            } ?>
                            <?php echo srcset_post_thumbnail(get_the_ID(), 'image', '', '(min-width: 50em) 33vw,100vw'); ?>
                        </a>
                    </figure>
                    <section class = 'rubric <?php echo $post_type; ?>'>
                        <a class = 'icon icon-dept_<?php echo $post_type; ?>' href = '<?php echo $post_link; ?>'></a>
                        <h2 class = '<?php echo $post_type; ?>'><a href = '<?php echo $post_link; ?>'><?php echo $postMenuName; ?></a>
                        <span class = 'topic'><?php echo $topic_urls; ?></span></h2>
                    </section>
                    <section class = 'titles'>
                        <h1><a href = <?php the_permalink(); ?>><?php the_title(); ?></a></h1>
                        <p><?php
                            if ($post_type != 'dharmatalks') {
                                if ($post_type == "filmclub") {
                                    echo "";
                                } else {
                                    the_excerpt();
                                }
                            }
                            ?></p>
                        <address><?php echo getAuthorDetail(get_the_ID(),1,0); ?></address>
                        <time><?php echo get_the_date('M d, Y'); ?></time>
                    </section>
                </article>
            
                <?php
                if($counter++ == 3)
                {
                    break;
                }
                
                endwhile;
            //wp_reset_query();
            ?> 
        </main>
    </div>
    <!-- end landing marquee -->

    <!-- start landing stack -->
    <div class='landing-stack'>

        <?php
        if (!empty($postId[0])) {
            $args = array(
                'post_type' => array('post', EBOOKS_POST_TYPE, MAGAZINE_POST_TYPE, FILM_CLUB_POST_TYPE, DHARMATALKS_POST_TYPE, FILM_FESTIVAL_POST_TYPE),
                
                'post_status' => 'publish',
                'post__not_in' => $postId,
                'order' => 'DESC',
                'orderby' => 'date',
                'posts_per_page' => 6,
            );
            $eq_query = new WP_Query($args);
            $count = 0;

            while (have_posts()): the_post();
            $postId[] = $post->ID;    
//                echo $count;
                if ($count == "3") {
                    ?>
                    <div class = 'CTA-module'>
                       <?php get_the_ad("authors_ad1_"); ?>
                    </div>
                    <?php
                }
                    
                    $post_type = get_post_type();
                    $postValues = get_post_type_object($post_type);
                    $labels = $postValues->labels; //to fetch the menu name
                    $postMenuName = $labels->menu_name;
                    $post_link = get_post_type_archive_link($post_type);
                    
                    if ($post_type == "post") {
                        $post_type = "trikedaily";
                        $postMenuName = "Trike Daily";
                        $post_link = get_permalink(get_page_id_by_slug(TRIKE_DAILY_SLUG));
                    }
                    $topics = get_topics_by_post_id(get_the_ID());
                    $topic_urls = $topics && isset($topics['names_with_urls']) ? implode(", ", $topics['names_with_urls']) : "";
                
                ?>
                <article class='<?php echo $post_type; ?>'>
                    <figure>
                        <a href='<?php the_permalink(); ?>'>
                            <?php if ($post_type == DHARMATALKS_POST_TYPE || $post_type == FILM_CLUB_POST_TYPE || $post_type == FILM_FESTIVAL_POST_TYPE ) { ?>
                                    <div class = 'icon-video_play' data-grunticon-embed></div>
                            <?php } ?>
                                <?php echo srcset_post_thumbnail(get_the_ID(), 'image', '', '(min-width: 37.5em) 25vw, 100vw'); ?>
                        </a>
                    </figure>
                    <section class = 'rubric <?php echo $post_type; ?>'>
                        <a class = 'icon icon-dept_<?php echo $post_type; ?>' href = '<?php echo $post_link; ?>'></a>
                        <h2 class = '<?php echo $post_type; ?>'><a href = '<?php echo $post_link; ?>'><?php echo $postMenuName; ?></a>
                        <span class = 'topic'>
                            <?php echo $topic_urls; ?>
                        </span></h2>
                    </section>
                    <section class = 'titles'>
                        <h1><a href = '<?php the_permalink(); ?>'><?php the_title() ?></a></h1>
                        <p><?php echo excerpt(35); ?></p>
                        <address><?php echo getAuthorDetail(get_the_ID(),1,0); ?></address>
                        <time><?php
                            if ($post_type == "magazine") {
                                $issue = get_the_terms($post->ID, "magazine-issue");
                                if(!empty($issue)){
                                    echo $issue[0]->name;
                                }
                            } else {
                                the_date('M Y');
                            }
                            ?></time>
                    </section>
                </article>
                <?php
                $count++;
            endwhile;
            wp_reset_query();
            ?>
                <?php if ($count > "5") { ?>
                <div class='more'>
                    <?php $postId = json_encode($postId); ?>
                    <!-- tax name, post type, url, post id's -->
                     <div id="loadingimage" style="position:relative"></div>
                    <input type="hidden" name="postId" id="postId" value="<?php echo $postId; ?>" > 
                    <input type="hidden" name="authorId" id="authorId" value="<?php echo $authorId; ?>" >
                    <a href='javascript:void(0)' id="LoadMore" onclick='LoadMoreAuthor()'>Load More</a>
                </div>
            <?php } ?>

<?php }
?> 


    </div>

    <div class = 'CTA-module'>
        <div class = 'CTA-module'>
        <?php get_the_ad("authors_ad2_"); ?>
        </div>
    </div>
    <!--end Call to Action module -->

    <aside>

        <div class = 'aside-depts'>
            <!--start aside trikedaily -->
                <?php show_latest_trike_daily(); ?>
            <!--end aside trikedaily -->

            <!--start aside magazine -->
                <?php show_latest_magazine_article(); ?>
            <!--end aside magazine -->

            <!--start aside dharma talks -->
                <?php show_latest_dharma_talks(); ?>
            <!--end aside dharma talks -->
        </div>

        <div class = 'rule'></div>

       
<?php get_footer();
?>    