function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires="+d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
} 
jQuery(function(){
    /*
     * query set to remove div rul responsive class from aside articles
     */
    if(jQuery('.rubric_small').length == 3){
        jQuery('div.rule-responsive').last().remove();
    }
    //Login
    jQuery("form#login #login-button").click(function(){
        if(jQuery.trim(jQuery("#l_email").val()) && jQuery.trim(jQuery("#l_pass").val()))
        {
            var thisFormId = $(this).closest('form').attr('id');
            active_form_id = thisFormId;
            jQuery(this).attr("disabled",true); 
            var usermail = jQuery("#l_email").val();
            
            /*jQuery.post(jQuery("form#login").attr("ref")+"/cambey-login.php", jQuery("form#login").serialize())
            .done(function(data) {
                var objData = JSON.parse(data);
                if(objData.status == "success")
                {
                    location.reload();
                }
                else if(objData.status == "fail")
                {
                    //alert(js_error);
                    loginmodal('login');
                    jQuery("#login-modal-email").val(usermail);
                    jQuery(".js_error").html('<span>'+objData.message+'</span>');
                }
            })
            .fail(function() {
               alert("Error!");
            });*/
            
            $.ajax({
                type:"POST",
                data:jQuery("form#"+active_form_id).serialize(),
                url: jQuery("form#"+active_form_id).attr("ref")+"/cambey-login.php",
                beforeSend: function(){  jQuery("#loadingimage_login").css("display","inline-block"); },
                success : function(data) {
                    var objData = JSON.parse(data);
                    console.log(objData);
                    if(objData.status == "success")
                    {
                        setCookie("Cambey_Login", objData.name, 365);
                        setCookie("Cambey_Account", window.btoa(objData.accountNo), 365);
                        location.reload();
                    }
                    else if(objData.status == "fail")
                    {
                        jQuery("#loadingimage_login").css("display","none");
                        jQuery(this).attr("disabled",false); 
                        jQuery('#login-button').removeAttr('disabled');
                        jQuery("#login-modal-submit").removeAttr("disabled",false); 
                        jQuery("#login-modal-email").val(usermail);
                        loginmodal('login');
                        jQuery(".js_error").html('<span>'+objData.message+'</span>');
                    }
                },
                error : function() {
                    jQuery("#login-button").attr("disabled",false);
                    jQuery("#loadingimage_login").css("display","none");
                    jQuery("#login-modal-submit").removeAttr("disabled",false); 
                    alert("Error!");
                }
            });
            
            
        }
        else
        {
            //alert("E-mail or Password can not be empty.");
            jQuery(this).removeAttr("disabled",false);
            loginmodal('login');
            jQuery(".js_error").html('<span>Please fill email and password.</span>');
        }
    });
    
    jQuery("form#login, form#login-modal-form, form#login-side-form, form#login_paywall").submit(function(event) {
        event.preventDefault();
    });
    
    jQuery("#login-paywall-button, #login-paywall-popup-button, #login-modal-submit, #side-login-submit").click(function(){
        console.log($(this));
        var thisFormId = $(this).closest('form').attr('id');
	active_form_id = thisFormId;
        var activebutton = jQuery(this);
        jQuery(activebutton).attr("disabled",true); 
        if(jQuery.trim(jQuery("form#"+active_form_id+" #l__paywall_email").val()) && jQuery.trim(jQuery("form#"+active_form_id+" #l_paywall_pass").val()))
        {
            /*jQuery.post(jQuery("form#"+active_form_id).attr("ref")+"/cambey-login.php", jQuery("form#"+active_form_id).serialize())
            .done(function(data) {
                var objData = JSON.parse(data);
                if(objData.status == "success")
                {
                    location.reload();
                }
                else if(objData.status == "fail")
                {   
                    jQuery("#login-modal-submit").removeAttr("disabled",false); 
                    jQuery(".paywall-modal").find('#paywall-modal-switch').prop('checked', false);
                    loginmodal('login');
                    jQuery(".js_error").html('<span>'+objData.message+'</span>');
                }
            })
            .fail(function() {
                jQuery("#login-modal-submit").removeAttr("disabled",false); 
               alert("Error!");
            });*/
           
            $.ajax({
                type:"POST",
                data:jQuery("form#"+active_form_id).serialize(),
                url: jQuery("form#"+active_form_id).attr("ref")+"/cambey-login.php",
                beforeSend: function(){  jQuery("#loadingimage_login").css("display","inline-block"); },
                success : function(data) {
                    var objData = JSON.parse(data);
                    console.log(objData);
                    if(objData.status == "success")
                    {
                        setCookie("Cambey_Login", objData.name, 365);
                        setCookie("Cambey_Account", window.btoa(objData.accountNo), 365);
                        location.reload();
                    }
                    else if(objData.status == "fail")
                    {
                        console.log("innnn");
                        jQuery(activebutton).attr("disabled",false); 
                        jQuery("#loadingimage_login").css("display","none");
                        jQuery("#login-modal-submit").removeAttr("disabled",false); 
                        jQuery(".paywall-modal").find('#paywall-modal-switch').prop('checked', false);
                        loginmodal('login');
                        jQuery(".js_error").html('<span>'+objData.message+'</span>');
                    }
                },
                error : function() {
                    jQuery(activebutton).attr("disabled",false);
                    jQuery("#loadingimage_login").css("display","none");
                    jQuery("#login-modal-submit").removeAttr("disabled",false); 
                    alert("Error!");
                }
            });
            
        }
        else
        {
            jQuery("#loadingimage_login").css("display","none");
            jQuery("#login-modal-submit").removeAttr("disabled",false);
            jQuery(this).attr("disabled",false); 
            jQuery(".paywall-modal").find('#paywall-modal-switch').prop('checked', false);
            //alert("E-mail or Password can not be empty.");
            loginmodal('login');
            jQuery(".js_error").html('<span>Please fill email and password.</span>');
        }
    });
    
    //Logout
    jQuery(".logout-link").click(function(){
        jQuery.post(jQuery("form#login").attr("ref")+"/cambey-login.php", {action: "logout"})
        .done(function(data) {
            var objData = JSON.parse(data);
            if(objData.status == "success")
            {
                setCookie("Cambey_Login", "", -1);
                setCookie("Cambey_Account", "", -1);
                jQuery('#login-button').removeAttr('disabled');
                location.reload();
            }
        })
        .fail(function() {
            alert("Error!");
        });
        /*setCookie("Cambey_Login", "", -1);
        setCookie("Cambey_Account", "", -1);
        jQuery('#login-button').removeAttr('disabled');
        location.reload();*/
    });
    
    jQuery(".showcomments").click(function(){        
        if($('#disqus_thread').is(':visible'))
        { 
            $("#disqus_thread").delay(500).fadeOut();
            $("#commentlink_title").html("View Comments");
        }else{  
            $("#disqus_thread").delay(500).fadeIn();
            $("#commentlink_title").html("Hide Comments");
        }                
    });
    
    /*$('.js_playvideo').click(function () {

        var videosrc = $(this).attr('rel');
        if(videosrc=="")
        {
            alert("Video src is empty.");
            return false;
        }
        var dept = ".article-video_featured";
        $('.article_playlist').find('h1').removeClass('play');
        $(this).find('h1').addClass('play');
        
        var videoTitle = $(this).attr('videotitle');
        $('.js_videoTitle').text(videoTitle);
        
        var videonum = $(this).attr('videonumber');
        $('.videonum').text(videonum);
        if(videonum!="1")
        {
             jQuery(".transcript").show();
        }
        if(videonum=="1")
        {
             jQuery(".transcript").hide();
        }
        var pdf_video = $(this).attr('linkpdf');
        if(pdf_video!=""){
            var downloadlink = downloadpdf+pdf_video;
            $("#pdf_download").attr("href",downloadlink);
        }
        
        $(dept + ' main section').css('margin', '0 0 1.2em');
        $(dept + ' .icon-video_play').css('display', 'none');
        $(dept + ' img').css('display', 'none');
        $(dept + ' .video-wrapper').css('display', 'block');
        $(dept + ' .video-wrapper').html('<iframe src="' + videosrc + '?autoplay=1&title=0&byline=0&portrait=0" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>');

    });
*/

    $('li.yeardropdown').click(function () {
        var year = $(this).attr('rel');
        if (year != "") {
            var currentUrl = pageurl;
            window.location.href = currentUrl + year;
        } else {
            return false;
        }

    });
    
    
    if ($('#back-to-top').length) {
        var scrollTrigger = 100, // px
            backToTop = function () {
                var scrollTop = $(window).scrollTop();
                if (scrollTop > scrollTrigger) {
                    $('#back-to-top').addClass('show');
                } else {
                    $('#back-to-top').removeClass('show');                
                }
                
            };
        backToTop();
        $(window).on('scroll', function () {
            backToTop();
        });
        $('#back-to-top').on('click', function (e) {
            e.preventDefault();
            $('html,body').animate({
                scrollTop: 0
            }, 700);
            $('.header-desktop .login-link').click();
        });
    }
    
});
        
//ajax call to load more posts for topic category and tags
function loadmoretopic(){
            var target = document.getElementById('loadingimage');
            var spinner = new Spinner(opts).spin(target);
            var postId=jQuery("#postId").val();
            var taxName=jQuery("#taxname").val();
            var taxonomy=jQuery("#taxonomy").val();
            jQuery("#PleaseLoadMore").remove();
            jQuery("#loadingimage").show();
            jQuery.ajax({
            type: 'POST',
            url: ajax_url,
            data: {
                action: 'loadmoreajax',
                postId: postId,
                taxname: taxName,
                taxonomy:taxonomy,
            },
            success: function (data, textStatus, XMLHttpRequest) {
                jQuery("#postId").remove();
                jQuery("#loadingimage").remove();
                jQuery(".loader-more").remove();
                jQuery(".landing-stack-1").append(data);
                //jQuery(data).insertAfter(':last');
                //jQuery(data).insertBefore(".more");
                
            },
            error: function (MLHttpRequest, textStatus, errorThrown) {
            alert(errorThrown);
            }
        });
    
 }
 
 //ajax call to load more posts for topic category and tags

 
 function LoadMoreAuthor()
 {
    var target = document.getElementById('loadingimage');
    var spinner = new Spinner(opts).spin(target);
    
    var PostId = jQuery("#postId").val();
    var AuthorId = jQuery("#authorId").val();
    jQuery("#LoadMore").remove();
    jQuery("#loadingimage").show();
    jQuery.ajax({
        type:'POST',
        url:ajax_url,
        data: {
             action: 'LoadMoreAuthor',
             postId: PostId,
             authorId: AuthorId,
        },
        
        success: function (data, textStatus, XMLHttpRequest) {
            jQuery("#postId").remove();
            jQuery("#loadingimage").remove();
            jQuery(".loader-more").remove();
            jQuery(".landing-stack").append(data);
         },
        error: function (MLHttpRequest, textStatus, errorThrown) {
            alert(errorThrown);
            }
    });
 }

 function loadmorearchive(){
            var target = document.getElementById('loadingimage');
            var spinner = new Spinner(opts).spin(target);
            var postId=jQuery("#postId").val();
            var posttype=jQuery("#posttype").val();
            var searchyear=jQuery("#searchyear").val();
            jQuery("#archiveloadmore").parent().remove();
            jQuery("#loadingimage").show();
            jQuery.ajax({
            type: 'POST',
            url: ajax_url,
            dataType: 'json',
            data: {
                action: 'archiveloadmore',
                postId: postId,
                posttype: posttype,
                searchyear:searchyear,
            },
            beforeSend: function(){
                jQuery("#loadingimage").css('height','50px');
            },
            success: function (data, textStatus, XMLHttpRequest) {
                jQuery("#loadingimage").css('height','0px');
                jQuery("#postId").remove();
                jQuery("#loadingimage").remove();
                jQuery('.loader-more').remove();
                jQuery("#moredata").append(data['html']);
                jQuery("#moredata").parent().append(data['pager']);
            },
            error: function (MLHttpRequest, textStatus, errorThrown) {
            alert(errorThrown);
            }
        });
  
   }
   
   function LoadMoreMagazine()
   {
       var target = document.getElementById('loadingimage');
       var spinner = new Spinner(opts).spin(target);
       var Topicstermid=jQuery("#TopicstermId").val();
       var oldyear = jQuery("#oldyear").val();
       //jQuery("#loadingimage").show();
       jQuery("#loadmoremagazine").parent().remove();
       jQuery.ajax({
            type: 'POST',
            url: ajax_url,
            dataType: 'json',
            data: {
                action: 'MagazineLoadMore',
                Topicstermid: Topicstermid,
                oldyear: oldyear,
               },
            success: function (data, textStatus, XMLHttpRequest) {
               jQuery("#TopicstermId").remove();
               jQuery("#loadingimage").remove();
               jQuery(".loader-more").remove();
               jQuery("#moredata").append(data['html']);
               jQuery("#moredata").parent().append(data['pager']);
              
            },
            error: function (MLHttpRequest, textStatus, errorThrown) {
            alert(errorThrown);
            }
        });
   }
   
   function LoadMoreTrikedaily()
   {
        var target = document.getElementById('loadingimage');
        var spinner = new Spinner(opts).spin(target);
        var PostId=jQuery("#postId").val();
        jQuery("#trikedailyloadmore").remove();
        jQuery("#loadingimage").show();
        jQuery.ajax({
            type: 'POST',
            url: ajax_url,
            data: {
                action: 'TrikeDailyLoadMore',
                postId: PostId,
               },
            beforeSend: function(){
                jQuery("#loadingimage").css('height','50px');
            },
            success: function (data, textStatus, XMLHttpRequest) {
               jQuery("#loadingimage").css('height','0px');
               jQuery("#postId").remove();
               jQuery('.loader-more').remove();
               jQuery("#loadingimage").remove();
               jQuery(".landing-stack").append(data);
               
            },
            error: function (MLHttpRequest, textStatus, errorThrown) {
            alert(errorThrown);
            }
        });
   
   }
   
   function loginmodal(dept){
    $('#login-modal-switch').prop('checked', true);
   }
