<?php get_header(); ?>
<?php

$postId = get_the_ID();
$topicSet = get_the_terms( $postId, "topic" );
$topicName = $topicSet[0]->name;
$topicSlug = $topicSet[0]->slug;
$objPost = get_post($postId);

/* call setPostView() function for increasing view counter of the post */
setPostViews($postId);

?>
	<!-- start content -->
		<div class='wrap_outer_base'>
			<main class='wrap_base'>

				<!-- start article -->
				<article class='article_base filmfestival'>
					<header class='article-header_video'>
						<h2 class='rubric filmfestival'>
							<a href='#' class='icon icon-dept_filmfestival'></a>
							<span class='dept'><a href='#'>Film Festival</a></span><span class='subdept'>Feature Film</span><span class='topic'><a href='<?php getTopicUrl($topicSlug); ?>'><?php echo $topicName; ?></a></span>
						</h2>
						<time><?php echo get_the_date('M d, Y'); ?></time>
						<h1><?php the_title(); ?></h1>
					</header>

					<!-- start article body -->
					<main class='article-main_film'>
						<div class='article-video_featured filmfestival'>
							<figure>
								<div class='icon-video_play' rel="<?php echo get_post_meta($postId ,'meta_type_filmfest_shorttrailer',true); ?>" data-grunticon-embed></div>
								<?php echo srcset_post_thumbnail(get_the_ID(), 'image', '','(min-width: 50em) 75vw,100vw'); ?>
								
								<div class='video-wrapper'>
								</div>
							</figure>
						</div>

						<div class='tools_top'>
							<ul>
								<li><a class='icon icon-tools_facebook' href='#' data-grunticon-embed></a></li>
								<li><a class='icon icon-tools_twitter' href='#' data-grunticon-embed></a></li>
								<li><a class='icon icon-tools_email' href='#' data-grunticon-embed></a></li>
								<li><a class='icon icon-tools_print' href='#' data-grunticon-embed></a></li>
							</ul>
						</div>

						<section class='article-body'>
							<p>
								<?php
								$authorname =  get_post_meta(get_the_ID() ,'authors_name_metabox',true);
								if($authorname!=""){
							?>
							
							Director: <?php echo $authorname; ?><br />
							<?php } ?>
							Country: Canada<br />
							Year: <?php echo get_the_date('Y'); ?></p>
							<p><a href=''>View Trailer</a></p>
							<p><?php echo $objPost->post_content; ?></p>
						</section>

						<div class='article-bottom-matter'>
							<?php 
								$tags_array = wp_get_post_tags($postId);
								if(!empty($tags_array)){
							?> 
							<section class='article-tags'>
								<ul>
									<?php foreach($tags_array as $tags){ ?>
										<li><p class='tag'><a href='<?php echo get_tag_link($tags->term_id); ?>'><?php echo ucfirst($tags->name); ?></a></p></li>
									<?php } ?>
									
								</ul>
							</section>
							<?php } ?>

							<div class='tools-wrap_bottom'>
								<ul class='tools'>
									<li><a class='icon icon-tools_facebook' href='#' data-grunticon-embed></a></li>
									<li><a class='icon icon-tools_twitter' href='#' data-grunticon-embed></a></li>
									<li><a class='icon icon-tools_email' href='#' data-grunticon-embed></a></li>
									<li><a class='icon icon-tools_print' href='#' data-grunticon-embed></a></li>
								</ul>
							</div>

							<div class='comments-toggle'>
								<a href='#'>View Comments</a>
							</div>
						</div>

					</main>

					<aside>
						<div class='ad_square'>
							<img src='<?php echo get_template_directory_uri(); ?>/images/jpg/ad-shinyocenter'>
						</div>

						<?php
							$mostpopularpost = getMostViewPosts(FILM_FESTIVAL_POST_TYPE,$postId,5);
							if(!empty($mostpopularpost)){
						?>
							<div class='popular-posts'>
								<header>
									<h1>Most Popular</h1>
								</header>
								
								<main>
									<ol>
								<?php
									
									$viewedposts= "";
									foreach($mostpopularpost as $mostpopular)
									{
										$viewedposts .= '<li><h1><a href="'.$mostpopular["permalink"].'">'.$mostpopular["title"].'</a></h1></li>';
									}
									echo $viewedposts;
									
								?>
									</ol>
								</main>
									
							</div>
						<?php } ?>
					</aside>

				</article>

			</main>
			<!-- end article wrap -->

			<aside>
				<!-- start related -->
				<?php
				
				$relatedposts =  getRelatedPosts($postId);
				if(!empty($relatedposts)){
				
				?>
				
					<div class='related-posts'>
						<header class='rubric_top'>
								<h1>Related</h1>
						</header>
	
						<main>
							<?php foreach($relatedposts as $relposts){
								
								$post_type = $relposts['postType'];
								
								if ($post_type == "article") {
									$post_type = "magazine";
								} else if ($post_type == "post") {
									$post_type = "trikedaily";
								} else if ($post_type == "dharma-talks") {
									$post_type = "dharmatalks";
								} else if ($post_type == "film-club") {
									$post_type = "filmclub";
								} else {
									$post_type;
								}							
							?>
							
							<article class='<?php echo $post_type ?>'>
								<figure>
									<a href='<?php echo $relposts['permalink']; ?>'>
										<?php if ($post_type == 'dharmatalks' || $post_type == 'filmclub') { ?>
											<div class='icon-video_play' data-grunticon-embed></div>
										<?php } ?>
										
										<?php echo srcset_post_thumbnail($relposts['postId'], 'image', '','(min-width: 37.5em) 33vw,100vw'); ?>
									</a>
								</figure>
								<section>
									<h2 class='rubric <?php echo $post_type ?>'><a href='<?php echo $post_type ?>' class='icon icon-dept_<?php echo $post_type ?>'></a><span class='dept'><a href='<?php echo $post_type; ?>'><?php echo ucfirst($post_type); ?></a><span class='topic'><a href='<?php getTopicUrl($relposts['topicSlug']); ?>'><?php echo $relposts['topicName']; ?></a></span></span></h2>
									<h1><a href='<?php echo $relposts['permalink']; ?>'><?php echo $relposts['title']; ?></a></h1>
									<address><?php echo $relposts['author_by_director']; ?>&nbsp;<?php echo $relposts['author']; ?></address>
								</section>
							</article>
	
							
							<?php } ?>
							
							<!--<article class='trikedaily'>
								<figure>
									<a href='#'>
										<img src='images/jpg/home-magazine_1x.jpg'
											srcset='images/jpg/home-magazine_2x.jpg 1000w,
															images/jpg/home-magazine_1x.jpg 500w'
											 sizes='(min-width: 37.5em) 33vw,
															100vw'
											alt='A man' />
									</a>
								</figure>
								<section>
									<h2 class='rubric trikedaily'><a href='#' class='icon icon-dept_trikedaily'></a><span class='dept'><a href='#'>Trike Daily</a><span class='topic'><a href='#'>Arts &amp; Culture</a></span></span></h2>
									<h1><a href='#'>Rich in mystery birth</a></h1>
									<address>By Romulus Jocelyne</address>
								</section>
							</article>
	
							
							<article class='filmclub'>
								<figure>
									<a href='#'>
										<div class='icon-video_play' data-grunticon-embed></div>
										<img src='images/jpg/home-magazine_1x.jpg'
											srcset='images/jpg/home-magazine_2x.jpg 1000w,
															images/jpg/home-magazine_1x.jpg 500w'
											 sizes='(min-width: 37.5em) 33vw,
															100vw'
											alt='A man' />
									</a>
								</figure>
								<section>
									<h2 class='rubric filmclub'><a href='#' class='icon icon-dept_filmclub'></a><span class='dept'><a href='#'>Film Club</a><span class='topic'><a href='#'>Mind &amp; Body</a></span></span></h2>
									<h1><a href='#'>Two ghostly white figures in coveralls and helmets are soflty dancing</a></h1>
									<address>By Bridget Thelonius</address>
								</section>
							</article>-->
						
						</main>
					</div>
				
				<?php } ?>
				<!-- end related -->

				<div class='rule'></div>

				<!-- start actions -->
				<div class='actions'>
					<div class='action'>
						<h2>Subscribe Today</h2>
						<h1>Tricycle is more than a magazine</h1>
						<p>Subscribe for access to video teachings, monthly films, e-books, and our 25-year archive. Plus: discounts on Tricycle online courses and events.</p>
						<a class='button' href='#'>Subscribe</a>
					</div>

					<div class='action'>
						<h2>Weekly Newsletter</h2>
						<h1>The latest from Tricycle to your inbox</h1>
						<form id='action-enews'>
							<input class='email' id='action-email' placeholder='Your email here' type='email'>

							<!-- enews modal -->
							<div class='action-modal'>
								<label for='action-modal-switch'>
									<button id='action-modal-trigger'>Sign Up</button>
								</label>
								<input class='modal-state' id='action-modal-switch' type='checkbox' />
							  <div class='modal-fade-screen'>
							    <div class='modal-inner'>
							      <div class='modal-close' for='action-modal-switch'></div>
							      <h1>Weekly Newsletter</h1>
							      <p>The latest from Tricycle to your inbox</p>
										<form name='action-modal-enews'>
											<input class='email' id='action-modal-email' placeholder='Your email here' type='email'>
											<label><input type='checkbox' name='enews' value='enews-tricycle' checked>The Tricycle Newsletter</label>
											<label><input type='checkbox' name='enews' value='enews-dailydharma' checked>Daily Dharma</label>
											<label><input type='checkbox' name='enews' value='enews-promotions' checked>Learn More</label>
											<button class='button'>Sign Up</button>
										</form>
							    </div>
							  </div>
							</div>
							<!-- end enews modal -->

						</form>
					</div>

					<div class='action'>
						<h2>Donate Now</h2>
						<p>Tricycle is a nonprofit organization that depends on reader support to make ends meet. Help us share Buddhist teachings and practices worldwide by donating now.</p>
						<a class='button' href='#'>Donate</a>
					</div>
				</div>
				<!-- end actions -->
			</aside>
		</div>
		<!-- end wrap_outer -->
<?php get_footer(); ?>